<!DOCTYPE html>
<!-- 
    WELCOME TO YOUR JUKEBOX CODE! 
    THIS IS THE MAIN FILE THAT CONTROLS EVERYTHING ON THE PAGE.
    
    GUIDE TO EDITING:
    1. TEXT IN GREY (LIKE THIS) ARE COMMENTS. THEY DO NOT AFFECT THE CODE.
    2. LOOK FOR THE SECTIONS IN CAPITAL LETTERS BELOW TO FIND WHAT YOU WANT TO CHANGE.
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PFA Jukebox</title>

    <!-- ================================================================================== -->
    <!-- EXTERNAL TOOLS (DO NOT TOUCH THESE LINKS)                                          -->
    <!-- THESE LINES LOAD THE TOOLS WE NEED TO MAKE THE SITE LOOK GOOD AND READ THE CSV FILE -->
    <!-- ================================================================================== -->
    
    <!-- TAILWIND CSS: MAKES STYLING EASIER (COLORS, SPACING, FONTS) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FONT AWESOME: PROVIDES THE ICONS (LIKE THE MAGNIFYING GLASS AND SPOTIFY LOGO) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- PAPAPARSE: THE TOOL THAT READS YOUR 'TRACKS.CSV' FILE -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <!-- ================================================================================== -->
    <!-- CUSTOM STYLES (CSS)                                                                -->
    <!-- USE THIS SECTION TO FINE-TUNE SCROLLBARS AND ANIMATIONS                            -->
    <!-- ================================================================================== -->
    <style>
        /* CONTROLS THE SCROLLBAR WIDTH */
        ::-webkit-scrollbar {
            width: 6px;
        }
        /* CONTROLS THE BACKGROUND COLOR OF THE SCROLLBAR TRACK */
        ::-webkit-scrollbar-track {
            background: #1e293b;
        }
        /* CONTROLS THE COLOR OF THE SCROLLBAR THUMB (THE PART YOU DRAG) */
        /* CURRENTLY SET TO GREEN (#4ade80) */
        ::-webkit-scrollbar-thumb {
            background: #4ade80;
            border-radius: 3px;
        }
        
        /* ANIMATION FOR ROWS FADING IN */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* HELPER TO HIDE SCROLLBARS IN SPECIFIC AREAS TO KEEP IT CLEAN */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>

<!-- ================================================================================== -->
<!-- MAIN BODY OF THE PAGE                                                              -->
<!-- 'bg-slate-900' IS THE DARK BACKGROUND COLOR.                                       -->
<!-- 'text-slate-200' IS THE DEFAULT TEXT COLOR.                                        -->
<!-- ================================================================================== -->
<body class="bg-slate-900 text-slate-200 font-sans antialiased h-screen flex flex-col overflow-hidden">

    <!-- ================================================================================== -->
    <!-- HEADER SECTION (TOP BAR)                                                           -->
    <!-- CONTAINS THE TITLE AND THE SEARCH BOX                                              -->
    <!-- ================================================================================== -->
    <header class="bg-slate-800 border-b border-slate-700 shadow-md z-20 shrink-0">
        <div class="max-w-3xl mx-auto p-4">
            
            <!-- TITLE BAR -->
            <!-- THE 'flex-col' AND 'items-start' CLASSES ALIGN THE TITLE ABOVE THE SEARCH BAR -->
            <div class="flex flex-col mb-4">

                <div class="flex justify-between items-center w-full">
                    <!-- MAIN TITLE TEXT -->
                    <h1 class="text-2xl font-bold text-green-400 tracking-wider flex items-center gap-3">
                        
                        <!-- LEFT MUSICAL NOTE ICON -->
                        <i class="fa-solid fa-music"></i> 
                        
                        <!-- THE TITLE TEXT -->
                        PFA JUKEBOX 
                        
                        <!-- RIGHT MUSICAL NOTE ICON -->
                        <i class="fa-solid fa-music"></i>
                    </h1>

                    <!-- LOGO INSERTION POINT -->
                    <img src="logo.png" alt="Logo" class="h-8 w-8 object-contain rounded-md">


                    <!-- LOADING INDICATOR (TOP RIGHT CORNER) -->
                    <div id="status-indicator" class="text-xs flex items-center gap-2">
                        <span id="loading-text" class="text-slate-500">Loading...</span>
                    </div>
                </div>
            </div>
            
            <!-- SEARCH BOX SECTION -->
            <div class="relative">
                <!-- MAGNIFYING GLASS ICON -->
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <i class="fa-solid fa-magnifying-glass text-slate-400"></i>
                </div>
                <!-- THE ACTUAL INPUT FIELD WHERE USERS TYPE -->
                <input type="text" id="search-input" 
                    class="block w-full pl-10 pr-3 py-3 border border-slate-600 rounded-xl leading-5 bg-slate-700 text-slate-100 placeholder-slate-400 focus:outline-none focus:bg-slate-700 focus:border-green-500 focus:ring-2 focus:ring-green-500 sm:text-base transition duration-150 ease-in-out shadow-lg" 
                    placeholder="Search by No, Track or Artist...">
            </div>
        </div>
    </header>

    <!-- ================================================================================== -->
    <!-- COLUMN HEADERS ROW (NO, TRACK NAME, ARTIST)                                        -->
    <!-- THIS IS JUST THE VISUAL LABEL BAR BELOW THE SEARCH BOX                             -->
    <!-- ================================================================================== -->
    <div class="bg-slate-800/80 border-b border-slate-700 text-xs font-semibold text-slate-400 uppercase tracking-wider sticky top-0 z-10 shadow-inner">
        <div class="max-w-3xl mx-auto px-2 py-2 flex items-center gap-2">
            <!-- 'NO.' HEADER -->
            <div class="w-14 text-center shrink-0">No.</div>
            
            <!-- 'TRACK NAME' HEADER -->
            <div class="flex-1 px-2">Track Name</div>
            
            <!-- 'ARTIST' HEADER (HIDDEN ON MOBILE PHONES 'hidden', VISIBLE ON TABLETS/PC 'sm:block') -->
            <div class="hidden sm:block flex-1 px-2">Artist</div>
            
            <!-- EMPTY SPACE FOR THE PLUS BUTTON -->
            <div class="w-10 text-center shrink-0"></div>
        </div>
    </div>

    <!-- ================================================================================== -->
    <!-- TRACK LIST CONTAINER                                                               -->
    <!-- THIS IS WHERE THE JAVASCRIPT WILL AUTOMATICALLY INJECT THE ROWS OF MUSIC           -->
    <!-- ================================================================================== -->
    <main id="track-list" class="flex-1 overflow-y-auto p-2 space-y-3 max-w-3xl mx-auto w-full pb-20">
        <!-- JAVASCRIPT WILL FILL THIS SPACE -->
    </main>

    <!-- ================================================================================== -->
    <!-- JAVASCRIPT LOGIC SECTION                                                           -->
    <!-- THIS IS THE BRAIN OF THE PAGE. IT READS THE FILE AND CREATES THE BUTTONS           -->
    <!-- ================================================================================== -->
    <script>
        // --- VARIABLES TO STORE DATA ---
        let allTracks = []; 
        const trackListElement = document.getElementById('track-list');
        const searchInput = document.getElementById('search-input');
        const statusIndicator = document.getElementById('status-indicator');
        const loadingText = document.getElementById('loading-text');

        // --- FALLBACK DATA (FOR TESTING OR IF CSV FAILS) ---
        // THESE ARE SAMPLE TRACKS USED IF THE 'tracks.csv' FILE IS NOT ACCESSIBLE
        const fallbackCSV = `No.,Track Name,Artist,Year Released,Album:,Spotify Link:,Youtube Link:
00-01,Heroes,David Bowie,1977,Bowie the singles 1968-1993,https://open.spotify.com/search/Heroes%20David%20Bowie,https://www.youtube.com/results?search_query=Heroes%20David%20Bowie%20music%20video
00-02,Beauty and the Beast,David Bowie,1978,Bowie the singles 1968-1993,https://open.spotify.com/search/Beauty%20and%20the%20Beast%20David%20Bowie,https://www.youtube.com/results?search_query=Beauty%20and%20the%20Beast%20David%20Bowie%20music%20video
60-05,Let Me Put My Love Into You,AC/DC,1980,Back in Black,https://open.spotify.com/search/Let%20Me%20Put%20My%20Love%20Into%20You%20AC/DC,https://www.youtube.com/results?search_query=Let%20Me%20Put%20My%20Love%20Into%20You%20AC/DC%20music%20video
60-06,Back In Black,AC/DC,1980,Back in Black,https://open.spotify.com/search/Back%20In%20Black%20AC/DC,https://www.youtube.com/results?search_query=Back%20In%20Black%20AC/DC%20music%20video
60-07,You Shook Me All Night Long,AC/DC,1980,Back in Black,https://open.spotify.com/search/You%20Shook%20Me%20All%20Night%20Long%20AC/DC,https://www.youtube.com/results?search_query=You%20Shook%20Me%20All%20Night%20Long%20AC/DC`;

        // --- INITIALIZATION: START THE APP ---
        function init() {
            // TRY TO LOAD 'tracks.csv'
            try {
                Papa.parse('tracks.csv', {
                    download: true,
                    header: true,
                    skipEmptyLines: true,
                    complete: function(results) {
                        console.log("CSV Loaded successfully");
                        processData(results.data);
                    },
                    error: function(err) {
                        console.warn("Could not load tracks.csv. Using fallback data.");
                        useFallbackData();
                    }
                });
            } catch (error) {
                console.warn("Caught synchronous error loading CSV. Using fallback data.");
                useFallbackData();
            }
        }

        // --- USE FALLBACK DATA IF REAL FILE IS MISSING ---
        function useFallbackData() {
            Papa.parse(fallbackCSV, {
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    processData(results.data);
                }
            });
        }

        // --- PROCESS DATA: PREPARE THE LIST FOR DISPLAY ---
        function processData(data) {
            // REMOVE EMPTY ROWS
            allTracks = data.filter(row => row['Track Name'] && row['Track Name'].trim() !== '');
            
            // UPDATE THE LOADING STATUS TEXT (TOP RIGHT)
            statusIndicator.innerHTML = `<span class="text-green-400 font-semibold">${allTracks.length} tracks loaded</span>`;

            // DRAW THE LIST ON SCREEN
            renderTracks(allTracks);
        }

        // --- RENDER TRACKS: THIS CREATES THE HTML FOR EACH SONG ---
        function renderTracks(tracks) {
            trackListElement.innerHTML = ''; // CLEAR THE LIST BEFORE DRAWING

            // IF SEARCH RETURNS NOTHING
            if (tracks.length === 0) {
                trackListElement.innerHTML = `
                    <div class="text-center py-10 text-slate-500">
                        No tracks found matching your search.
                    </div>`;
                return;
            }

            // LOOP THROUGH EVERY TRACK AND CREATE THE HTML
            tracks.forEach((track, index) => {
                const uniqueId = `track-${index}`;
                
                // --- READ DATA FROM CSV COLUMNS ---
                // IF YOU CHANGE HEADERS IN EXCEL, CHANGE THEM HERE TOO
                const num = track['No.'] || 'N/A';
                const title = track['Track Name'] || 'Unknown Title';
                const artist = track['Artist'] || 'Unknown Artist';
                const year = track['Year Released'] || '';
                const album = track['Album:'] || '';
                const spotify = track['Spotify Link:'];
                const youtube = track['Youtube Link:'];

                // STYLE FOR THE MAIN ROW CONTAINER
                const row = document.createElement('div');
                row.className = 'bg-slate-800 rounded-xl shadow-lg border border-slate-700 overflow-hidden fade-in hover:border-green-600/50 hover:bg-slate-700/50 transition-all duration-200';
                
                // --- THE HTML STRUCTURE FOR A SINGLE ROW ---
                row.innerHTML = `
                    <!-- VISIBLE PART OF THE ROW (CLICKABLE) -->
                    <div class="flex items-center gap-2 p-3 cursor-pointer select-none" onclick="toggleDetails('${uniqueId}')">
                        
                        <!-- TRACK NUMBER (WHITE TEXT) -->
                        <div class="w-14 text-center font-mono font-bold text-white shrink-0 text-sm bg-slate-900/50 py-1 rounded-md shadow-inner">
                            ${num}
                        </div>

                        <!-- TRACK TITLE & ARTIST (MOBILE VIEW) -->
                        <div class="flex-1 px-2 min-w-0 flex flex-col justify-center">
                            <div class="text-slate-100 font-medium truncate text-base">${title}</div>
                            <!-- ARTIST SHOWS HERE ONLY ON MOBILE -->
                            <div class="text-xs text-slate-400 truncate sm:hidden">${artist}</div>
                        </div>

                        <!-- ARTIST COLUMN (DESKTOP VIEW ONLY) -->
                        <div class="hidden sm:block flex-1 px-2 text-slate-400 truncate">
                            ${artist}
                        </div>

                        <!-- THE GREEN PLUS BUTTON -->
                        <div class="w-10 flex justify-center shrink-0">
                            <button id="btn-${uniqueId}" class="w-8 h-8 rounded-full bg-green-500 hover:bg-green-400 text-slate-900 flex items-center justify-center transition-transform duration-200 shadow-xl shadow-green-900/40">
                                <i class="fa-solid fa-plus text-sm"></i>
                            </button>
                        </div>
                    </div>

                    <!-- HIDDEN DETAILS (EXPANDS WHEN CLICKED) -->
                    <div id="${uniqueId}" class="hidden bg-slate-900/90 border-t border-slate-700/50 text-sm">
                        <div class="p-4 grid gap-3">
                            
                            <!-- EXTRA INFO: YEAR AND ALBUM -->
                            <div class="flex flex-wrap gap-4 text-slate-400">
                                ${year ? `<div class="flex items-center gap-2"><i class="fa-regular fa-calendar text-green-500"></i> ${year}</div>` : ''}
                                ${album ? `<div class="flex items-center gap-2"><i class="fa-solid fa-compact-disc text-green-500"></i> ${album}</div>` : ''}
                            </div>

                            <!-- BUTTONS: SPOTIFY AND YOUTUBE -->
                            <div class="flex gap-3 mt-4">
                                <!-- SPOTIFY BUTTON LOGIC -->
                                ${spotify && spotify.trim() !== '' ? `
                                    <a href="${spotify}" target="_blank" class="flex-1 bg-[#1DB954] hover:bg-[#1ed760] text-white py-3 px-4 rounded-lg text-center font-semibold transition flex items-center justify-center gap-2 shadow-xl shadow-green-900/30">
                                        <i class="fa-brands fa-spotify text-xl"></i> Spotify
                                    </a>
                                ` : '<span class="flex-1 bg-slate-700 text-slate-500 py-3 px-4 rounded-lg text-center cursor-not-allowed flex items-center justify-center gap-2">No Spotify Link</span>'}
                                
                                <!-- YOUTUBE BUTTON LOGIC -->
                                ${youtube && youtube.trim() !== '' ? `
                                    <a href="${youtube}" target="_blank" class="flex-1 bg-[#FF0000] hover:bg-[#ff3333] text-white py-3 px-4 rounded-lg text-center font-semibold transition flex items-center justify-center gap-2 shadow-xl shadow-red-900/30">
                                        <i class="fa-brands fa-youtube text-xl"></i> YouTube
                                    </a>
                                ` : '<span class="flex-1 bg-slate-700 text-slate-500 py-3 px-4 rounded-lg text-center cursor-not-allowed flex items-center justify-center gap-2">No YouTube Link</span>'}
                            </div>
                        </div>
                    </div>
                `;
                
                trackListElement.appendChild(row);
            });
        }

        // --- CLICK HANDLER: OPENS AND CLOSES THE ROW ---
        window.toggleDetails = function(id) {
            const detailsPanel = document.getElementById(id);
            const button = document.getElementById(`btn-${id}`);

            if (detailsPanel.classList.contains('hidden')) {
                // OPEN THE ROW
                detailsPanel.classList.remove('hidden');
                button.classList.add('bg-slate-200', 'rotate-45'); // ROTATE BUTTON TO MAKE AN 'X'
                button.classList.remove('bg-green-500');
            } else {
                // CLOSE THE ROW
                detailsPanel.classList.add('hidden');
                button.classList.remove('bg-slate-200', 'rotate-45');
                button.classList.add('bg-green-500');
            }
        };

        // --- SEARCH HANDLER: LISTENS FOR TYPING ---
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            
            const filtered = allTracks.filter(track => {
                const title = (track['Track Name'] || '').toLowerCase();
                const artist = (track['Artist'] || '').toLowerCase();
                const num = (track['No.'] || '').toLowerCase();
                
                // CHECKS IF SEARCH TERM MATCHES TITLE, ARTIST, OR NUMBER
                return title.includes(searchTerm) || 
                       artist.includes(searchTerm) || 
                       num.includes(searchTerm);
            });

            renderTracks(filtered);
        });

        // START THE APP
        init();

    </script>
</body>
</html>
